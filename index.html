<html>
<head>
<script type="text/javascript">
var grid={
"A":{"A":"X","B":"R","C":"F","D":"F","E":"E","I":"F","J":"A","M":"E","P":"F","V":"F","L":"A","R":"C","S":"A","T":"F","W":"A","Z":"S"},
"B":{"A":"R","B":"X","C":"F","D":"F","E":"E","I":"F","J":"A","M":"E","P":"F","V":"A","L":"A","R":"F","S":"A","T":"F","W":"A","Z":"S"},
"C":{"A":"F","B":"F","C":"X","D":"F","E":"A","I":"A","J":"C","M":"E","P":"A","V":"A","L":"F","R":"F","S":"A","T":"F","W":"F","Z":"F"},
"D":{"A":"F","B":"F","C":"F","D":"X","E":"A","I":"A","J":"F","M":"C","P":"S","V":"S","L":"A","R":"F","S":"F","T":"F","W":"A","Z":"S"},
"E":{"A":"E","B":"C","C":"A","D":"A","E":"X","I":"R","J":"E","M":"F","P":"A","V":"S","L":"E","R":"C","S":"A","T":"F","W":"E","Z":"A"},
"I":{"A":"F","B":"F","C":"A","D":"A","E":"R","I":"X","J":"F","M":"E","P":"A","V":"A","L":"F","R":"F","S":"S","T":"F","W":"A","Z":"S"},
"J":{"A":"A","B":"A","C":"A","D":"F","E":"E","I":"F","J":"X","M":"E","P":"F","V":"F","L":"R","R":"F","S":"E","T":"C","W":"F","Z":"S"},
"M":{"A":"E","B":"E","C":"E","D":"S","E":"F","I":"E","J":"E","M":"X","P":"S","V":"S","L":"E","R":"C","S":"F","T":"C","W":"A","Z":"S"},
"P":{"A":"F","B":"F","C":"A","D":"S","E":"A","I":"A","J":"F","M":"S","P":"X","V":"C","L":"F","R":"F","S":"A","T":"F","W":"F","Z":"S"},
"V":{"A":"F","B":"A","C":"A","D":"S","E":"S","I":"A","J":"F","M":"S","P":"C","V":"X","L":"F","R":"F","S":"A","T":"F","W":"F","Z":"S"},
"L":{"A":"A","B":"A","C":"F","D":"A","E":"E","I":"F","J":"R","M":"E","P":"F","V":"F","L":"X","R":"F","S":"A","T":"F","W":"F","Z":"S"},
"R":{"A":"F","B":"F","C":"F","D":"F","E":"F","I":"F","J":"F","M":"F","P":"F","V":"F","L":"F","R":"X","S":"F","T":"F","W":"F","Z":"A"},
"S":{"A":"A","B":"A","C":"A","D":"F","E":"A","I":"S","J":"E","M":"F","P":"A","V":"A","L":"A","R":"F","S":"X","T":"F","W":"F","Z":"R"},
"T":{"A":"F","B":"F","C":"F","D":"F","E":"F","I":"F","J":"F","M":"F","P":"F","V":"F","L":"F","R":"F","S":"F","T":"X","W":"F","Z":"A"},
"W":{"A":"C","B":"A","C":"F","D":"A","E":"E","I":"A","J":"F","M":"A","P":"F","V":"F","L":"F","R":"F","S":"F","T":"F","W":"X","Z":"S"},
"Z":{"A":"S","B":"S","C":"F","D":"S","E":"A","I":"S","J":"S","M":"S","P":"S","V":"S","L":"S","R":"A","S":"R","T":"A","W":"S","Z":"X"}
};
var rel =[
["A","B"],
["E","I"],
["J","L"],
["Z","S"]
];
var cru =[
["A","R"],
["C","J"],
["D","M"],
["E","B"],
["E","R"],
["J","T"],
["M","R"],
["M","T"],
["P","V"],
["V","P"],
["W","A"]
];

function matchPair(a, b) {
	var a2b = grid[a][b];
	var b2a = grid[b][a];
	if(a2b==b2a) {
			 if (a2b == "A") return 1;
		else if (a2b == "F") return 2;
		else if (a2b == "R") return 3;
		else if (a2b == "C") return 4;
		else if (a2b == "E") return -4;
	} else if (a2b == "C" || b2a == "C") return 1;
	
	return 0;
}

function strength(unit) {
	var score = 0;
	for(var i=0; i<unit.length-1; i++) {
		score += matchPair(unit.charAt(i), unit.charAt(i+1));
	}
	
	for(var v=0; v<rel.length; v++) {
		var perA = rel[v][0];
		var perB = rel[v][1];
		var posA = unit.indexOf(perA);
		var posB = unit.indexOf(perB);
		var dist = Math.abs(posB-posA);
		var dir = (posB-posA)/dist;
		if (dist>1) {
			var isCrush = false;
			for(var u=posA+dir; u!=posB && !isCrush; u+=dir) {
				var perN = unit.charAt(u);
				var n2a = grid[perN][perA];
				var n2b = grid[perN][perB];
				if(n2a == "C" || n2b== "C")
					isCrush = true;
			}
			if(isCrush)
				score -= 3;
			else
				score -= 2;
		}
	}
	for(var t=0; t<cru.length; t++) {
		var perA = cru[t][0];
		var perB = cru[t][1];
		var posA = unit.indexOf(perA);
		var posB = unit.indexOf(perB);
		var dist = Math.abs(posB-posA);
		if (dist>1) {
			var posR = -1;
			for(var s=0; s<rel.length; s++) {
				if(rel[s][0]==perB)
					posR = unit.indexOf(rel[s][1]);
				else if(rel[s][1]==perB)
					posR = unit.indexOf(rel[s][0]);
			}
			if(posR>-1){
				if(posA>posR && posR<posB)
					score+=-2;
				else if(posA<posR && posR<posB)
					score+=-2;
			}	
		}
	}
	
	if(grid[unit.charAt(0)][unit.charAt(1)]=="S")
		score+=-1;
	if(grid[unit.charAt(unit.length-2)][unit.charAt(unit.length-1)]=="S")
		score+=-1;
	for (var w=1; w<unit.length-1; w++){
		if(grid[unit.charAt(w)][unit.charAt(w-1)]=="S" && grid[unit.charAt(w)][unit.charAt(w+1)] =="S")
			score+=-1;
	}
	
	return score;
}

function breed(a,b) {
	var entropy = 10;
	var split = 12;
	var newA = a.substring(0,split);
	var newB = b.substring(0,split);
	for(var i=0; i<a.length; i++) {
		if(newA.indexOf(b.charAt(i))<0)
			newA+=b.charAt(i);
		if(newB.indexOf(a.charAt(i))<0)
			newB+=a.charAt(i);
	}
	var r1=Math.floor(Math.random()*(1000));
	if(r1<=entropy){
		var oldA = newA;
		var s=Math.floor(Math.random()*(16));
		var e=Math.floor(Math.random()*(16));
		if(s>e){
			var temp = s;
			s = e;
			e = temp;
		}
		if(s!=e)
			newA = newA.substring(0,s-1)+newA.charAt(e-1)+newA.substring(s,e-1)+newA.charAt(s-1)+newA.substring(e,16);
	}
	var r2=Math.floor(Math.random()*(1000));
	if(r2<=entropy){
		var s=Math.floor(Math.random()*(16));
		var e=Math.floor(Math.random()*(16));
	}
	return [newA, newB];
}
function total(list){
	var total = 0;
	for(var i=0; i<list.length;i++) {
		total+=list[i][1];
	}
	return total;
}
var opt = "ABCDEIJMPVLRSTWZ";

function spawn() {
	var localOpt = opt;
	var localList = [];
	for(var i=0; i<16; i++) {
		var r=Math.floor(Math.random()*(16-i));
		localList[i] = localOpt.charAt(r);
		localOpt = localOpt.substring(0,r)+localOpt.substring(r+1, (16-i));
	}
	return localList.join("");
}
function s(a,b) {
	return a[1] - b[1];
}
function populate(list, rate) {
	list = list.sort(s);
	var top = list.length*rate;
	var children=[];
	for(var i=1; i<=top; i+=2){
		var newUnits = breed(list[list.length-i][0],list[list.length-i-1][0]);
		//alert(newUnits[0]+"|"+newUnits[1]);
		for(var u=0; u<newUnits.length; u++) {
			children[children.length] = [newUnits[u],strength(newUnits[u])];
		}
	}
	//alert(list[3][0]+"|"+children[3][0]);
	for(var i=0; i<top; i++) {
		list[i] = children[i];
	}
	//alert(list[3][0]+"|"+children[3][0]);
	
	list = list.sort(s);
	return list;
}

var populace = [];
var populaceSize = 1000;
var deathRate = .10;
for(var i=0;i<populaceSize;i++) {
	var newSpawn = spawn();
	populace[i] = ([newSpawn, strength(newSpawn)]);
}
var gen0 = populace.sort(s);
alert(total(gen0)+"|"+gen0[999][0]+"|"+gen0[999][1]);
for(var i=0; i<15; i++) {
	gen0 = populate(gen0, deathRate);
	//alert(total(gen0)+"|"+gen0[999][0]+"|"+gen0[999][1]);
}
alert(total(gen0)+"|"+gen0[999][0]+"|"+gen0[999][1]);
document.write(gen0);
</script>
</head>
<body>
</body>
</html>